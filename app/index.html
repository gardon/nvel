<!DOCTYPE html>
<html lang="en" id="scroll-top">
<head>

  <!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta charset="utf-8">
  <title>Nvel - Loading...</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <!-- FONT
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">

  <!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="stylesheet" href="/css/normalize.css">
  <link rel="stylesheet" href="/css/skeleton.css">
  <link rel="stylesheet" href="/css/nvel.css">

  <!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="icon" type="image/png" href="/images/favicon.png">

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-ML7KZRL');</script>
  <!-- End Google Tag Manager -->

</head>
<body id="scroll-top">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-ML7KZRL"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div id="fb-root"></div>
  <script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = 'https://connect.facebook.net/pt_BR/sdk.js#xfbml=1&version=v2.11&appId=1689418697967004&autoLogAppEvents=1';
    fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>

  <!-- Primary Page Layout
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <div id="main">
    <div class="row ">
        <span class="loading-icon"></span>
      </div>
    </div>
    <script src="/main.js"></script>
    <script>
      var node = document.getElementById('main');
      var app = Elm.Main.embed(node);
      app.ports.updatePageData.subscribe(function(pagedata) {
        document.title = pagedata.title;
        htmlEl = document.documentElement;
        htmlEl.lang = pagedata.lang;

        if (dataLayer !== undefined) {
          dataLayer.push({
            'event': 'virtualPageView',
            'page': {
              'title': pagedata.title,
              'path' : document.location.pathname
            }
          })
        }
      });

      app.ports.pageChange.subscribe(function() {
        // Refresh facebook
        if (typeof FB != "undefined") {
          window.setTimeout(FB.XFBML.parse, 500);
        }
        window.setTimeout(function() { lazyLoad(0) }, 500);
      });

      var scroll = window.pageYOffset || document.body.scrollTop;
      var toggle = true;
      var scrollup = 0;

      window.onscroll = function() {
        var newScroll = window.pageYOffset || document.body.scrollTop;
        if (newScroll > scroll && newScroll > 60) {
          if (toggle) {
            hideNav();
            toggle = false;
          }
          scrollup = 0;
        }
        else {
          scrollup += scroll - newScroll;
          if (toggle === false && scrollup > 60) {
            showNav();
            toggle = true;
          }
        }
        scroll = newScroll;
        lazyLoad(scroll);
      };

      function lazyLoad(scroll) {
        var images = document.querySelectorAll('.lazy-section.not-loaded');
        for (i = 0; i < images.length; i++) {
          image = images[i];
          if (image.offsetTop < scroll + 1000) {
            var ids = image.id.split("-");
            app.ports.lazyLoad.send({chapter: ids[1], section: Number(ids[2])})
          }
        }
      }

      window.onload = function() {
        window.setTimeout(function() { lazyLoad(scroll  ) }, 500);
      }

      function hideNav() {
        app.ports.navBar.send(false);
      }
      function showNav() {
        app.ports.navBar.send(true);
      }

    </script>
  </div>

<!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
</body>
</html>
